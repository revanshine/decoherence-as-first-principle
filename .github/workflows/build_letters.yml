name: Build Letters

on:
  push:
    branches: [ letters ]
  pull_request:
    branches: [ letters ]

permissions:
  contents: write

jobs:
  build-letters:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Install pandoc
        uses: r-lib/actions/setup-pandoc@v2
        with:
          pandoc-version: '3.1.11'
          
      - name: Install TeX Live (full)
        run: sudo apt-get update && sudo apt-get install -y texlive-latex-recommended texlive-latex-extra texlive-fonts-recommended texlive-fonts-extra
        
      - name: Build Letters
        run: bash build/build_letters.sh
        
      - name: Upload Letter PDFs
        uses: actions/upload-artifact@v4
        with:
          name: letters-pdf
          path: build/out/letters/*.pdf
          
      - name: Create Release (on push only)
        if: github.event_name == 'push'
        uses: softprops/action-gh-release@v2
        with:
          tag_name: letters-latest
          name: Latest Letters Release
          body: |
            Automated PDF letters produced from the letters branch.
            
            This release contains:
            - Gravitational Decoherence Oscillations letter
            - Black Hole Galaxy letter  
            - Collapse Oscillator letter
          files: |
            build/out/letters/*.pdf
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
